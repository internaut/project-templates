#include "jni_img_proc.h"JNIEXPORT void JNICALL Java_net_mkonrad_stillimageprocndkdroid_JNIImgProc_grayscale(JNIEnv *env, jobject obj, jintArray pixels) {	// lock memory and get pointer to pixels    jint *pxPtr = env->GetIntArrayElements(pixels, 0);    jsize len = env->GetArrayLength(pixels);    if (!pxPtr) {	// check pointer    	LOGERR("failed to get pointer to pixel data");        return;    }    // do grayscale conversion    LOGINF("starting to convert %d pixels to grayscale values", len);    for (int i = 0; i < len; ++i) {        jint px = pxPtr[i];        unsigned char r = (px >> 16) & 0xFF;        unsigned char g = (px >> 8) & 0xFF;        unsigned char b = px & 0xFF;        // do weighted average        unsigned char grayVal = (unsigned char)((float)r * 0.299f + (float)g * 0.587f + (float)b * 0.114f);        pxPtr[i] = (0xFF000000)						| (grayVal << 16)						| (grayVal <<  8)						| grayVal;    }    LOGINF("done converting");    // release the memory    env->ReleaseIntArrayElements(pixels, pxPtr, 0);
}